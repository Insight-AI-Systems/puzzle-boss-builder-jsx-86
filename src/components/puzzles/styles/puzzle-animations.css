
/* Puzzle piece animations */
.puzzle-piece {
  transition: all 0.2s ease-out;
  position: relative; /* Ensure position context for z-index */
}

.puzzle-piece-dragging {
  z-index: 100 !important; /* Ensure dragged pieces are always on top */
  transition: transform 0.1s ease-out;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

/* Correctly placed pieces should have lower z-index but never hide unplaced pieces */
.puzzle-piece-correct {
  box-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
  animation: correct-piece 0.5s ease;
  z-index: 5 !important; /* Correctly placed pieces stay at bottom */
}

/* Unplaced pieces should ALWAYS be above correctly placed pieces */
.puzzle-piece:not(.puzzle-piece-correct) {
  z-index: 20 !important; /* Unplaced pieces always above placed ones */
}

/* Force pieces to top on any interaction */
.puzzle-piece:focus, 
.puzzle-piece:hover, 
.puzzle-piece:active {
  z-index: 50 !important; /* Interaction raises even correctly placed pieces temporarily */
}

/* Force any selected piece to stay on top */
.puzzle-piece.selected {
  z-index: 80 !important;
}

/* Apply a distinctive visual treatment to make trapped pieces more visible */
.puzzle-piece.trapped {
  z-index: 30 !important;
  box-shadow: 0 0 12px rgba(255, 0, 0, 0.7) !important;
  animation: trapped-piece-pulse 1.5s infinite alternate;
}

.puzzle-piece-hint {
  animation: hint-piece 2s infinite;
  z-index: 40 !important; /* Hints should be very visible */
}

/* Puzzle completion animation */
.puzzle-complete {
  animation: complete-puzzle 2s ease;
}

/* Keyframes for piece movements */
@keyframes correct-piece {
  0% {
    transform: scale(1);
    box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 8px rgba(255, 215, 0, 0.7);
  }
}

@keyframes hint-piece {
  0%, 100% {
    box-shadow: 0 0 3px rgba(0, 179, 179, 0.3);
  }
  50% {
    box-shadow: 0 0 10px rgba(0, 179, 179, 0.8);
  }
}

@keyframes trapped-piece-pulse {
  0% {
    box-shadow: 0 0 8px rgba(255, 0, 0, 0.5);
    transform: scale(1);
  }
  100% {
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
    transform: scale(1.08);
  }
}

@keyframes complete-puzzle {
  0% {
    box-shadow: 0 0 0 rgba(255, 215, 0, 0);
  }
  50% {
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
  }
  100% {
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }
}

/* Touch specific enhancements */
@media (pointer: coarse) {
  .puzzle-piece:active {
    transform: scale(1.05);
    z-index: 50 !important; /* Higher z-index for touch interactions */
  }
  
  /* Larger touch targets */
  .puzzle-piece {
    touch-action: none; /* Prevent browser handling of gestures */
  }
  
  /* Mobile-friendly direction controls */
  .direction-button-touch {
    min-width: 44px;
    min-height: 44px;
  }
}

/* Device-specific adjustments */
@media (max-width: 480px) {
  .puzzle-grid-mobile {
    gap: 2px;
    padding: 4px;
  }
  
  .puzzle-piece-mobile {
    border-radius: 4px;
  }
}

/* Smooth transition for pinch-to-zoom */
.transform-gpu {
  transform-origin: center;
  will-change: transform;
  backface-visibility: hidden;
}
